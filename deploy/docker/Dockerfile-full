FROM ubuntu:22.04

COPY nanomq-*-msquic.deb ./
COPY deploy/docker/docker-entrypoint.sh /usr/bin/docker-entrypoint.sh

RUN apt-get update \
    && DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends libatomic1 \
    && DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends ./nanomq-*-linux-$(dpkg --print-architecture)-msquic.deb \
    && rm -rf /var/lib/apt/lists/* \
    && rm -rf *.deb

EXPOSE 1883 8883 8081

ENTRYPOINT ["/usr/bin/docker-entrypoint.sh"]

CMD ["--url", "nmq-tcp://0.0.0.0:1883"]
